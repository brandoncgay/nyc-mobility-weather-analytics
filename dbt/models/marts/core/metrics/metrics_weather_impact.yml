metrics:
  # ============================================
  # WEATHER CONDITION METRICS
  # ============================================

  - name: trips_in_adverse_weather
    description: "Number of trips during adverse weather conditions"
    type: simple
    label: "Trips in Adverse Weather"
    type_params:
      measure: trip_count
    filter: |
      {{ Dimension('trip__is_adverse_weather') }} = true

  - name: trips_in_pleasant_weather
    description: "Number of trips during pleasant weather conditions"
    type: simple
    label: "Trips in Pleasant Weather"
    type_params:
      measure: trip_count
    filter: |
      {{ Dimension('trip__is_pleasant_weather') }} = true

  - name: trips_in_rain
    description: "Number of trips during rain"
    type: simple
    label: "Trips in Rain"
    type_params:
      measure: trip_count
    filter: |
      {{ Dimension('trip__precipitation_type') }} = 'rain'

  - name: trips_in_snow
    description: "Number of trips during snow"
    type: simple
    label: "Trips in Snow"
    type_params:
      measure: trip_count
    filter: |
      {{ Dimension('trip__precipitation_type') }} = 'snow'

  - name: citibike_trips_good_cycling_weather
    description: "CitiBike trips during good cycling weather"
    type: simple
    label: "CitiBike - Good Cycling Weather"
    type_params:
      measure: trip_count
    filter: |
      {{ Dimension('trip__is_good_cycling_weather') }} = true
      AND {{ Dimension('trip__trip_type') }} = 'citibike'

  # ============================================
  # WEATHER IMPACT RATIOS
  # ============================================

  - name: adverse_weather_trip_rate
    description: "Percentage of trips during adverse weather"
    type: derived
    label: "Adverse Weather Trip %"
    type_params:
      expr: trips_in_adverse_weather / total_trips
      metrics:
        - trips_in_adverse_weather
        - total_trips

  - name: rain_impact_on_trips
    description: "Percentage of trips during rain"
    type: derived
    label: "Rain Impact %"
    type_params:
      expr: trips_in_rain / total_trips
      metrics:
        - trips_in_rain
        - total_trips

  # ============================================
  # TEMPERATURE SEGMENTED METRICS
  # ============================================

  - name: trips_in_cold_weather
    description: "Trips during cold weather (< 0°C)"
    type: simple
    label: "Trips - Cold Weather"
    type_params:
      measure: trip_count
    filter: |
      {{ Dimension('trip__temp_category') }} = 'cold'

  - name: trips_in_hot_weather
    description: "Trips during hot weather (≥ 30°C)"
    type: simple
    label: "Trips - Hot Weather"
    type_params:
      measure: trip_count
    filter: |
      {{ Dimension('trip__temp_category') }} = 'hot'

  - name: trips_in_mild_weather
    description: "Trips during mild weather (10-20°C)"
    type: simple
    label: "Trips - Mild Weather"
    type_params:
      measure: trip_count
    filter: |
      {{ Dimension('trip__temp_category') }} = 'mild'

  # ============================================
  # AVERAGE METRICS BY WEATHER
  # ============================================

  - name: avg_trip_duration_adverse_weather
    description: "Average trip duration during adverse weather"
    type: simple
    label: "Avg Duration - Adverse Weather"
    type_params:
      measure: avg_trip_duration
    filter: |
      {{ Dimension('trip__is_adverse_weather') }} = true

  - name: avg_trip_duration_pleasant_weather
    description: "Average trip duration during pleasant weather"
    type: simple
    label: "Avg Duration - Pleasant Weather"
    type_params:
      measure: avg_trip_duration
    filter: |
      {{ Dimension('trip__is_pleasant_weather') }} = true
